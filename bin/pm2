#!/usr/bin/env bash

function show_usage {
    echo "pm2 [raysoda|rapixel|osoky|drypot] [dev|live]"
    exit 1
}

if [ $# -lt 2 ]; then
    show_usage
fi

if [ "$2" = dev ]; then
    CONFIG_DIR=config
    #export NODE_ENV=development
elif [ "$2" = live ]; then
    CONFIG_DIR=config-live
    export NODE_ENV=production
else
    show_usage
fi

export NODE_ENV=production
export NODE_OPTIONS='-r ts-node/register -r tsconfig-paths/register'
export TS_NODE_PROJECT=src/server/tsconfig.json

args=(
    start
    bin/pm2-runner.mjs
    --name $1
    --exp-backoff-restart-delay=2000
    --
    ${CONFIG_DIR}/${1}-${2}.json
)

set -o xtrace
pm2 "${args[@]}"
